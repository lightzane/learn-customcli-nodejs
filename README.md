# Learn Custom CLI

Learn to create a custom `CLI` tool using [nodejs](https://nodejs.org/)

## Demo

### 1. Install dependencies

```bash
npm install
```

### 2. Install package globally as a shortcut reference

```bash
npm install -g
```

### 3. Test

```bash
cli --pokemon pikachu
cli -i
```

### 4. Uninstall package

```bash
npm uninstall -g
```

# Getting Started

1. [Install Typescript](#install-typescript)
2. [Building CLI Tools](#building-cli-tools)

- [CLI Options](#cli-options) (optional)
- [Interactive CLI Tools](#interactive-cli-tools) (optional)

# Install Typescript

```bash
npm i -D typescript
```

## Setup Typescript Config

```bash
npx tsc --init --outDir ./bin
```

Generated **tsconfig.json**

```json
{
  "compilerOptions": {
    "target": "es2016",
    "module": "commonjs",
    "outDir": "./bin",
    "esModuleInterop": true,
    "forceConsistentCasingInFileNames": true,
    "strict": true,
    "skipLibCheck": true,
    "removeComments": true
  }
}
```

# Building CLI Tools

`src/index.ts`

```ts
#!/usr/bin/env node

console.log('Hello World');
```

`package.json`

```json
{
  "scripts": {
    "start": "npm run build && node bin",
    "build": "tsc --build --clean && tsc",
    "package": "npm run build && npm pack"
  },
  "bin": {
    "cli": "bin/index.js"
  }
}
```

Unlike `node bin` that will automatically execute `index.js` by default, it is **important** that we put `bin/index.js` instead of just `bin` folder in `bin.cli` of `package.json`.

> **NOTE**: You can change `cli` to your preferred CLI name, thus will be the command name to execute.

**Run command** to test the application

```bash
cli # your-cli-name provided unded "bin" key in package.json
```

If you encountered an error that `cli` is not recognized, then you must execute the following command:

```bash
npm i -g
```

> This **MUST** be executed within the project root directory.

This will create a shortcut reference to your current project directory in your **global node_modules**.

**Output**

```bash
Hello World
```

### Install Globally

```bash
npm i -g
```

This will install a reference shortcut to your current project directory. Meaning, everything you update directly in the source code, will immediately reflect in the global `cli` command, since the one we installed globally is only a **shortcut reference**.

**DO NOT FORGET TO UNINSTALL AFTER DEVELOPMENT**

```bash
npm uninstall -g
```

> This **MUST** be executed within the project root directory.

### Share your package

Or installing global package without creating a shortcut reference...

#### 1. Modify `package.json`

Specify the files that we want to bundle in our `npm pack` command. In this case, it will be the `bin` folder which is generated by the Typescript build command `tsc`. We do not want to include our `src` folder as it is only for development.

```diff
{
  ...
+ "files": [
+   "bin"
+ ],
}
```

**Note**: Even we only specified to bundle `bin` folder, it will still include the `package.json` and `README.md` file within the `npm pack` command.

#### 2. Run the following command

**Make sure that you have your latest Typescript build generated**

```bash
npm pack
```

And it will generate a `npm_package_name-x.x.x.tgz` file.

```bash
npm i -g npm_package_name-x.x.x.tgz
npm uninstall -g npm_package_name
```

You can then run the following command to locate where your CLI has been installed...

##### Windows

```bash
where cli
```

##### OS / Linux

```bash
which cli
```

# For Development Purposes

```bash
npm i -g
```

To install a shortcut reference from your current project directory to your global node_modules.

Since we are using Typescript, we always have to `npm run build` before actually calling your **CLI command**, in our case, it's `cli` command.

After development, when you're all set, never forget to:

```bash
npm uninstall -g
```

# CLI Options

We can pass input arguments

```ts
console.log(process.argv);
```

**CLI**

```bash
cli --pokemon pikachu
```

**Output**

```bash
[
  'C:\\Program Files\\nodejs\\node.exe',
  'C:\\Users\\<user>\\path\\to\\index.js',
  '--pokemon',
  'pikachu'
]
```

## Using yargs package

https://www.npmjs.com/package/yargs

```bash
npm i yargs
```

**With Typescript**, install additional _types_

```bash
npm i -D @types/yargs
```

`src/index.ts`

```js
import yargs from 'yargs';

const { argv } = yargs(process.argv);

console.log(argv);
```

**CLI**

```bash
cli --pokemon pikachu --sample sampleInput --other
```

**Output**

```bash
{
  _: [
    'C:\\Program Files\\nodejs\\node.exe',
    'C:\\Users\\<user>\\path\\to\\index.js'
  ],
  pokemon: 'pikachu',
  sample: 'sampleInput',
  other: true,
  '$0': '..\\..\\relative\\path\\to\\global\\index.js'
}
```

### Yargs Typescript Usage Examples

Reference: https://github.com/yargs/yargs/blob/main/docs/typescript.md#typescript-usage-examples

**src/index.ts**

```ts
const argv = yargs(process.argv.slice(2))
  .options({
    pokemon: { type: 'string' },
    sample: { type: 'string' },
    other: { type: 'boolean' },
  })
  .parseSync();

console.log(argv);
```

**Input**

```bash
cli --pokemon pikachu --sample --other
```

**Output**

```bash
{
  _: [],
  pokemon: 'pikachu',
  sample: '',
  other: true,
  '$0': '..\\..\\relative\\path\\to\\global\\index.js'
}
```

# Interactive CLI Tools

Reference: https://github.com/SBoudrias/Inquirer.js?tab=readme-ov-file#inquirer

```bash
npm install @inquirer/prompts
```

`src/index.ts`

```ts
import { input } from '@inquirer/prompts';

async function main() {
  const answer = await input({ message: 'Enter your name' });
  console.log(answer);
}

main();
```

**Output**

```bash
~>learn-customcli-nodejs>cli
? Enter your name pikachu
pikachu
```

`@inquirer/prompts` includes all the following:

- [`@inquirer/input`](https://github.com/SBoudrias/Inquirer.js/tree/master/packages/input#inquirerinput)
- [`@inquirer/select`](https://github.com/SBoudrias/Inquirer.js/tree/master/packages/select#inquirerselect)
- [`@inquirer/checkbox`](https://github.com/SBoudrias/Inquirer.js/tree/master/packages/checkbox#inquirercheckbox)
- [`@inquirer/confirm`](https://github.com/SBoudrias/Inquirer.js/tree/master/packages/confirm#inquirerconfirm)
- [`@inquirer/password`](https://github.com/SBoudrias/Inquirer.js/tree/master/packages/password#inquirerpassword)
- [`@inquirer/expand`](https://github.com/SBoudrias/Inquirer.js/tree/master/packages/expand#inquirerexpand)
- [`@inquirer/editor`](https://github.com/SBoudrias/Inquirer.js/tree/master/packages/editor#inquirereditor)
- [`@inquirer/rawlist`](https://github.com/SBoudrias/Inquirer.js/tree/master/packages/rawlist#inquirerrawlist)

So you can install them individually, like so:

```bash
npm install @inquirer/input
```

## References

- `yargs` **Passing Arguments** https://www.npmjs.com/package/yargs
  - `yargs` with Typescript https://github.com/yargs/yargs/blob/main/docs/typescript.md#typescript-usage-examples
- `@inquirer/prompts` **Interactive CLI** https://github.com/SBoudrias/Inquirer.js?tab=readme-ov-file#inquirer
